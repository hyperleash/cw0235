- name: Check if SSH key already exists
  stat:
    path: "~/.ssh/test_identity"
  register: ssh_key

- name: Generate SSH key
  command: ssh-keygen -t rsa -b 4096 -N "" -f "~/.ssh/test_identity"
  when: not ssh_key.stat.exists